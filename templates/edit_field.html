<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Путь к успеху</title>
<!--    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">-->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #progress {
            width: 100%;
            background-color: #f3f3f3;
            border: 1px solid #ccc;
            height: 30px;
            display: none;
        }
        #progress-bar {
            width: 0;
            height: 100%;
            background-color: #4caf50;
        }

    </style>
</head>

<header>
    <div class="header-container">
        <img src="{{ url_for('static', filename='img/Profile_banner.png') }}" alt="Баннер" class="header-banner">
        <div class="logo-container">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Логотип" class="logo">
        </div>
        <div class="navigator">
            <h6>Путь к успеху</h6>
            <nav>
                <a href="{{ url_for('index') }}">Главная</a>
                <a href="{{ url_for('spisok') }}">Список детей</a>
                <a href="{{ url_for('events') }}">Список конкурсов</a>
                <a href="{{ url_for('karta') }}">Карта маршрута</a>
                <a href="{{ url_for('logout') }}" class="logout-button">Выйти</a> <!-- Кнопка Выйти -->
            </nav>
        </div>
    </div>
</header>

<body>
    <h1>Добавить запись в таблицу данных</h1>
    <form  id="uploadForm" action="{{ url_for('add_data_entry',  child_id=id_spisok) }}" method="post" enctype="multipart/form-data">

        <label for="fio">ФИО:</label>
            <input type="hidden" type="text" id="fio" name="id_spisok" value="{{ child[0] }}" readonly>
            <span>{{ child[1] }}</span>
        <br><br>

        <label for="competition">Конкурс:</label>
        <select name="id_events_table" id="competition" required>
            {% for event in events %}
                <option value="{{ event[0] }}">{{ event[1] }}</option>
            {% endfor %}
        </select>
        <br><br>

<!--        <label for="date">Дата:</label>-->
<!--        <input type="date" name="srok_podachi_date" id="date" required>-->
<!--        <br><br>-->

        <label for="doc_type">Результат:</label>
<!--        <input type="text" name="result" id="result" >-->
            <select name="doc_type" id="doc_type" >
                {% for doc_t in docs %}
                    <option value="{{ doc_t }}">{{ doc_t }}</option>
                {% endfor %}
            </select>
        <br><br>

        <label for="fileInput">Файл:</label>
        <input type="file" name="fileInput" id="fileInput" accept=".txt,.pdf,.doc,.docx">
        <input type="hidden" name="saved_file_name" id="saved_file_name">
        <div id="progress">
            <div id="progress-bar"></div>
        </div>
        <div id="message"></div>
        <br><br>

        <input type="submit" value="Добавить запись">
    </form>

    <a href="{{ url_for('child_profile', child_id=id_child) }}"> Назад </a>

    <script>
         // Генерация уникального имени файла
        document.getElementById('saved_file_name').value = 'file_' + Date.now() + '_' + Math.floor(Math.random() * 1000); // без расширения

        $("#fileInput").on("change", function() {
            var formData = new FormData($("#uploadForm")[0]);

            $("#progress").show();
            $("#progress-bar").width(0); // сбрасываем прогресс бар

            $.ajax({
                xhr: function() {
                    var xhr = new window.XMLHttpRequest();
                    // Обработчик события загрузки для отслеживания прогресса
                    xhr.upload.addEventListener("progress", function(evt) {
                        if (evt.lengthComputable) {
                            var percentComplete = evt.loaded / evt.total;
                            percentComplete = parseInt(percentComplete * 100);
                            $("#progress-bar").width(percentComplete + '%');
                        }
                    }, false);
                    return xhr;
                },
                type: "POST",
                url: "{{ url_for('upload_file') }}",
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    // Обработка успешного ответа
                    $("#message").text("Файл загружен успешно!");
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // Обработка ошибок
                    $("#message").text("Ошибка загрузки файла.");
                }
            });
        });
    </script>
</body>
</html>